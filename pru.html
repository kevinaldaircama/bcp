<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Enviar a</title>
<link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#01256f" />

  <!-- Favicon -->
  <link rel="icon" type="images/png" href="images/app_icon_xxxhdpi.png"> 
<style>
  body {margin:0;font-family:'Roboto',sans-serif;background:#fff;color:#000;}
  .header{background:#0046BE;color:white;display:flex;align-items:center;justify-content:space-between;padding:12px 16px;font-size:18px;font-weight:500;}
  .header span{font-size:18px;cursor:pointer;}
  .container{padding:20px;}
  .profile{text-align:center;margin-top:10px;}
  .profile .circle{background:#2A6FF5;color:white;width:55px;height:55px;border-radius:50%;display:flex;justify-content:center;align-items:center;margin:0 auto 10px;font-size:22px;font-weight:bold;}
  .profile h2{margin:0;font-size:18px;}
  .profile p{margin:4px 0;color:#777;font-size:14px;}
  hr{border:none;border-top:1px solid #ddd;margin:20px 0;}
  .section-title{color:#0046BE;font-weight:500;margin-bottom:8px;font-size:15px;}
  .currency-toggle{display:flex;gap:8px;margin-bottom:10px;}
  .currency-toggle button{flex:1;padding:8px;border-radius:20px;border:1px solid #ccc;background:#f3f3f3;font-size:16px;color:#777;cursor:pointer;}
  .currency-toggle button.active{background:#E7EEF9;color:#0046BE;border-color:#0046BE;}
  .amount{font-size:42px;color:#0046BE;font-weight:500;display:flex;align-items:center;gap:6px;}
  .amount input{border:none;outline:none;font-size:42px;color:#444;width:150px;}
  .account-card{border:1px solid #ddd;border-radius:12px;padding:14px;margin-top:10px;display:flex;justify-content:space-between;align-items:center;}
  .account-info{font-size:14px;}
  .account-info strong{display:block;color:#000;font-size:15px;}
  .account-info span{color:#777;}
  .account-balance{color:#0046BE;font-weight:500;}
  .btn{margin:40px auto 10px;display:block;width:90%;max-width:400px;padding:12px;border:none;border-radius:30px;background:#d6d6d6;color:white;font-size:16px;cursor:not-allowed;transition:background .3s;}
  .btn.active{background:#0046BE;cursor:pointer;}
  /* Modal Ã©xito */
  .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.75);justify-content:center;align-items:center;z-index:9999;}
  .modal-content{background:#0046BE;color:white;text-align:center;padding:30px 25px;border-radius:16px;width:85%;max-width:350px;}
  .modal-content h2{margin-bottom:12px;font-size:22px;}
  .modal-content p{margin:6px 0;font-size:16px;}
  .btn-ok{background:#ff6600;border:none;padding:10px 18px;color:white;border-radius:10px;margin-top:15px;font-size:15px;cursor:pointer;}
  /* Modal carga */
  .loading-modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.75);justify-content:center;align-items:center;z-index:9999;}
  .loader-container{position:relative;width:120px;height:120px;}
  .loader-circle{position:absolute;top:0;left:0;width:120px;height:120px;border:6px solid transparent;border-top:6px solid #ff6600;border-radius:50%;animation:spin 1.2s linear infinite;}
  .loader-logo{position:absolute;top:50%;left:50%;width:70px;height:70px;transform:translate(-50%,-50%);}
  @keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
</style>
</head>
<body>

<div class="header">
  <span id="back">&larr;</span>
  <span>Enviar a</span>
  <span class="close">&times;</span>
</div>

<div class="container">
  <div class="profile">
    <div class="circle" id="circle">?</div>
    <h2 id="nombre">---</h2>
    <p id="numero">---</p>
    <p>Moneda soles</p>
  </div>

  <hr>

  <div>
    <div class="section-title">Moneda y monto</div>
    <div class="currency-toggle">
      <button class="active">S/</button>
      <button>$</button>
    </div>
    <div class="amount">
      <span>S/</span>
      <input type="text" value="0.00" id="montoInput">
    </div>
  </div>

  <div style="margin-top:30px;">
    <div class="section-title">Desde</div>
    <div class="account-card">
      <div class="account-info">
        <strong>Cuenta Digital Soles</strong>
        <span id="origenCuenta">----</span>
      </div>
      <div class="account-balance" id="saldoCuenta">S/ 0.00</div>
    </div>
  </div>

  <button class="btn" id="continuarBtn">Continuar</button>
</div>

<!-- Modal Ã©xito -->
<div class="modal" id="successModal">
  <div class="modal-content">
    <h2>âœ… Datos guardados</h2>
    <p><strong>Nombre:</strong> <span id="modalNombre"></span></p>
    <p><strong>Cuenta:</strong> <span id="modalCuenta"></span></p>
    <p><strong>Banco:</strong> BCP</p>
    <button class="btn-ok" id="btnOk">Aceptar</button>
  </div>
</div>

<!-- Modal carga -->
<div class="loading-modal" id="loadingModal">
  <div class="loader-container">
    <div class="loader-circle"></div>
    <img src="images/lg_favicon_light.svg" class="loader-logo" alt="Logo">
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDvfMTYu_d_Vl0z-3Y8ld_YtcFLGgZmP0U",
    authDomain: "bcpf-e0a42.firebaseapp.com",
    databaseURL: "https://bcpf-e0a42-default-rtdb.firebaseio.com",
    projectId: "bcpf-e0a42",
    storageBucket: "bcpf-e0a42.firebasestorage.app",
    messagingSenderId: "1030005921701",
    appId: "1:1030005921701:web:0c15124cadf030280f7a4c",
    measurementId: "G-SVYPBTLHDE"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const nombreElem = document.getElementById("nombre");
  const numeroElem = document.getElementById("numero");
  const circle = document.getElementById("circle");
  const origenCuenta = document.getElementById("origenCuenta");
  const saldoCuenta = document.getElementById("saldoCuenta");
  const inputMonto = document.getElementById("montoInput");
  const boton = document.getElementById("continuarBtn");

  // Obtener datos desde localStorage
    const nombre = localStorage.getItem("nombre") || "Usuario";
    const numero = localStorage.getItem("numero") || "0000";
    const origen = localStorage.getItem("origen") || "0000";

  // Mostrar perfil
  nombreElem.textContent = nombre;
  numeroElem.textContent = "****" + numero.slice(-4);
  circle.textContent = nombre.charAt(0).toUpperCase();

  // Obtener saldo desde Firebase
  const dbRef = ref(db);
  get(child(dbRef, "usuarios/" + origen)).then(snapshot => {
    if (snapshot.exists()) {
      const data = snapshot.val();
      saldoCuenta.textContent = `S/ ${parseFloat(data.saldo).toFixed(2)}`;
      origenCuenta.textContent = "****" + origen.slice(-4);
    } else {
      saldoCuenta.textContent = "S/ 0.00";
      origenCuenta.textContent = "****" + origen.slice(-4);
    }
  });

  // Manejar input de monto con 0.00 visible
  inputMonto.value = "0.00";
  inputMonto.addEventListener("focus", () => {
    if (inputMonto.value === "0.00") inputMonto.value = "";
  });
  inputMonto.addEventListener("blur", () => {
    if (inputMonto.value.trim() === "") inputMonto.value = "0.00";
  });

  // Activar botÃ³n si hay monto vÃ¡lido
  inputMonto.addEventListener("input", () => {
    const valor = parseFloat(inputMonto.value);
    if (!isNaN(valor) && valor > 0) {
      boton.classList.add("active");
      boton.disabled = false;
    } else {
      boton.classList.remove("active");
      boton.disabled = true;
    }
  });

// ðŸš€ Redirigir a la otra pÃ¡gina con datos guardados
boton.addEventListener("click", () => {
  const monto = parseFloat(inputMonto.value);
  if (isNaN(monto) || monto <= 0) return;

  // Guardar temporalmente el monto para usarlo en la siguiente pÃ¡gina
  localStorage.setItem("montoTransferencia", monto.toFixed(2));

  // Redirigir al cÃ³digo principal (por ejemplo: confirmar.html)
  window.location.href = "confirma"; 
});
</script>
</body>
</html>